webpackJsonp([36],{"0b9I":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("Xxa5"),n=a.n(r),o=a("woOf"),l=a.n(o),i=a("exGp"),s=a.n(i),c=a("vLgD");function u(e){return Object(c.a)({url:"/management-web/http/do.jhtml?router=roleService.getAdminTreeData",method:"post",data:e})}function m(e){return Object(c.a)({url:"/management-web/http/do.jhtml?router=roleService.listUsers",method:"post",data:e})}function d(e){return Object(c.a)({url:"/management-web/http/do.jhtml?router=roleService.listSelectedUsers",method:"post",data:e})}function f(e){return Object(c.a)({url:"/management-web/http/do.jhtml?router=roleService.deleteRoleUserGrantInfo",method:"post",data:e})}var p=a("8Wt3"),h=a("RbaZ"),v={name:"rolesManage",components:{Tree:p.a},data:function(){return{list:null,listLoading:!0,treeData:[],treeData2:[],treeData3:[],multipleSelection:[],form:{grouping:"",biz_code:"",type:"1",name:"",is_enable:"0",remark:"",create_time:""},dialogParams:{model:{},manageTreeDialog:!1,value:[],data:[],cascade:!0,selModel:[]},selectArr:[],enableSelect:[{name:"是",value:"1"},{name:"否",value:"0"}],listQuery:{startPage:1,limit:10,name:""},total:0,isDialogShow:!1,isEditDialogShow:!1,isGrantDialogShow:!1,isChooseRoleDialogShow:!1,rules:{}}},created:function(){var e,t=this;this.fetchData(this.listQuery),(e={key:"user_type",type:"hash"},Object(c.a)({url:"/management-web/http/do.jhtml?router=cacheCustomService.listValues",method:"post",data:e})).then(function(e){e.rows.map(function(e){return e.value=JSON.parse(e.value),e}),t.selectArr=e.rows,console.log(e,"sdasdasd")})},watch:{},methods:{fetchData:function(e){var t=this;return s()(n.a.mark(function a(){var r,o;return n.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return(r=l()({},e)).startPage--,t.listLoading=!0,a.prev=3,a.next=6,n=r,Object(c.a)({url:"/management-web/http/do.jhtml?router=roleService.listRole",method:"post",data:n});case 6:o=a.sent,t.list=o.rows,t.listLoading=!1,t.total=o.total,a.next=16;break;case 12:a.prev=12,a.t0=a.catch(3),console.log(a.t0),t.listLoading=!1;case 16:t.initForm();case 17:case"end":return a.stop()}var n},a,t,[[3,12]])}))()},changeValue:function(e){this.fetchData(this.listQuery)},handleSelectionChange:function(e){this.multipleSelection=e,console.log(e)},handleSizeChange:function(e){this.listQuery.limit=e,this.fetchData(this.listQuery)},handleCurrentChange:function(e){this.listQuery.startPage=e,this.fetchData(this.listQuery)},btnAdd:function(){this.isDialogShow=!0,this.initForm()},btnEdit:function(){var e=this.multipleSelection,t=e.length,a=e[0];t>1?this.$message({message:"只能选中一个修改",type:"warning",duration:3e3,showClose:!0}):0!==t?(this.isEditDialogShow=!0,this.form=l()(this.form,a),console.log(a)):this.$message({message:"请选中一条",type:"warning",duration:3e3,showClose:!0})},btnDelete:function(){var e=this;return s()(n.a.mark(function t(){var a,r;return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=e.multipleSelection,0!==a.length){t.next=3;break}return t.abrupt("return");case 3:return r={aos_rows:a.map(function(e){return e.id}).join()},t.prev=4,t.next=7,e.btnDeleteConfirm();case 7:return t.sent,t.next=10,n=r,Object(c.a)({url:"/management-web/http/do.jhtml?router=roleService.deleteRole",method:"post",data:n});case 10:return t.next=12,e.fetchData(e.listQuery);case 12:e.$message({type:"success",message:"删除成功!"}),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(4),e.$message({type:"info",message:"已取消删除"});case 18:case"end":return t.stop()}var n},t,e,[[4,15]])}))()},btnDeleteConfirm:function(){return this.$confirm("此操作将永久删除这些文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"})},inputSearch:function(){var e=l()({},this.listQuery);console.log(e),this.fetchData(e)},grantBtn:function(e){var t=this;return s()(n.a.mark(function a(){return n.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return t.dialogParams.model=e,t.dialogParams.manageTreeDialog=-1!=e.id,a.next=4,r={role_id:e.id,grant_type:1,node:0},Object(c.a)({url:"/management-web/http/do.jhtml?router=roleService.getTreeData",method:"post",data:r});case 4:return t.treeData=a.sent,a.next=7,u({role_id:e.id,grant_type:2,node:0});case 7:t.treeData2=a.sent,t.isGrantDialogShow=!0;case 9:case"end":return a.stop()}var r},a,t)}))()},grantSaveBtn:function(){this.isGrantDialogShow=!1;var e,t=this.dialogParams.model,a=this.$refs.grantTree.getCheckedNodes();console.log(a),e={role_id:t.id,save_biz:!0,save_admin:!1,grant_rows:a.map(function(e){return e.id}).join()},Object(c.a)({url:"/management-web/http/do.jhtml?router=roleService.saveGrantInfo",method:"post",data:e})},selectRoleBtn:function(e){var t=this;return s()(n.a.mark(function a(){var r,o,l,i;return n.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return t.dialogParams.model=e,console.log(e,"mmmmmmmmmmmm"),r={role_id:e.id,cascade:t.dialogParams.cascade,page:1,start:0,limit:50},n=void 0,o=Object(c.a)({url:"/management-web/http/do.jhtml?router=orgService.getTreeData",method:"post",data:n}),l=m(r),i=d(r),a.t0=h.a,a.next=7,o;case 7:return a.t1=a.sent,t.treeData3=(0,a.t0)(a.t1),a.next=11,l;case 11:return a.t2=a.sent.rows,a.next=14,i;case 14:return a.t3=a.sent.rows,t.dialogParams.data=a.t2.concat.call(a.t2,a.t3),a.next=18,i;case 18:return a.t4=function(e){return e.id},t.dialogParams.value=a.sent.rows.map(a.t4),a.next=22,i;case 22:t.dialogParams.selModel=a.sent.rows,t.isChooseRoleDialogShow=!0;case 24:case"end":return a.stop()}var n},a,t)}))()},transferChange:function(e,t,a){var r=this;return s()(n.a.mark(function o(){var l,i;return n.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(console.log(e,t,a),l=r.dialogParams.model.id,"right"!==t){n.next=7;break}return n.next=5,o={role_id:l,aos_rows:a.join()},Object(c.a)({url:"/management-web/http/do.jhtml?router=roleService.saveRoleUserGrantInfo",method:"post",data:o});case 5:n.next=10;break;case 7:return i=r.dialogParams.data.filter(function(e){return a.some(function(t){return t===e.id})}).map(function(e){return e.user_role_id}).join(),n.next=10,f({aos_rows:i});case 10:return n.next=12,r.selectRoleBtn(r.dialogParams.model);case 12:case"end":return n.stop()}var o},o,r)}))()},transferFilter:function(e,t){return!e||t.name.indexOf(e)>-1},closeDialog:function(){this.isDialogShow=!1,this.isEditDialogShow=!1},confirmBtn:function(){var e=this;return s()(n.a.mark(function t(){return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,a=e.form,Object(c.a)({url:"/management-web/http/do.jhtml?router=roleService.saveRole",method:"post",data:a});case 3:t.sent,e.fetchData(e.listQuery),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),console.log(t.t0);case 10:e.closeDialog(),e.initForm();case 12:case"end":return t.stop()}var a},t,e,[[0,7]])}))()},confirmEditBtn:function(){var e=this;return s()(n.a.mark(function t(){return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,a=e.form,Object(c.a)({url:"/management-web/http/do.jhtml?router=roleService.updateRole",method:"post",data:a});case 3:t.sent,e.fetchData(e.listQuery),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),console.log(t.t0);case 10:e.closeDialog(),e.initForm();case 12:case"end":return t.stop()}var a},t,e,[[0,7]])}))()},treeNodeClick:function(e){var t=this;return s()(n.a.mark(function a(){var r;return n.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return console.log(e),a.next=3,m({role_id:-1,cascade:t.dialogParams.cascade,org_id:e.id,org_cascade_id:e.a,page:1,start:0,limit:50});case 3:r=a.sent,console.log(r),t.dialogParams.data=r.rows.concat(t.dialogParams.selModel);case 6:case"end":return a.stop()}},a,t)}))()},initForm:function(){this.form=l()(this.form,{grouping:"",biz_code:"",type:"1",name:"",is_enable:"0",remark:"",create_time:""}),this.listQuery.name=""}},mounted:function(){}},g={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("div",[a("el-button",{attrs:{round:""},on:{click:e.btnAdd}},[e._v("新增")]),e._v(" "),a("el-button",{attrs:{round:""},on:{click:e.btnEdit}},[e._v("编辑")]),e._v(" "),a("el-button",{attrs:{round:""},on:{click:e.btnDelete}},[e._v("删除")]),e._v(" "),a("div",{staticStyle:{display:"inline-block"}},[a("el-form",{ref:"form",attrs:{model:e.form,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"角色名称"}},[a("el-input",{nativeOn:{keyup:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key))return null;e.inputSearch(t)}},model:{value:e.listQuery.name,callback:function(t){e.$set(e.listQuery,"name",t)},expression:"listQuery.name"}})],1)],1)],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading.body",value:e.listLoading,expression:"listLoading",modifiers:{body:!0}}],attrs:{data:e.list,"element-loading-text":"Loading",border:"",fit:"","highlight-current-row":""},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"角色名称",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.name)+"\n      ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"是否启用",width:"150",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.is_enable)+"\n      ")]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"角色类型",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.type)+"\n      ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"扩展码",width:"150",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.biz_code))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"创建人",width:"150",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.username)+"\n      ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"创建时间",width:"150",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.create_time)+"\n      ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"备注",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.remark)+"\n      ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"授权",width:"150",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"danger",plain:""},on:{click:function(a){e.grantBtn(t.row)}}},[e._v("授权")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"选择用户授权",width:"150",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"primary",plain:""},on:{click:function(a){e.selectRoleBtn(t.row)}}},[e._v("选择用户")])]}}])})],1),e._v(" "),a("div",{staticClass:"pagination-container"},[a("el-pagination",{attrs:{background:"","current-page":e.listQuery.startPage,"page-sizes":[10,20,30,50],"page-size":e.listQuery.limit,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),a("el-dialog",{attrs:{title:"新增参数",visible:e.isDialogShow},on:{"update:visible":function(t){e.isDialogShow=t}}},[a("el-form",{ref:"dataForm",staticStyle:{width:"400px","margin-left":"50px"},attrs:{rules:e.rules,model:e.form,"label-position":"left","label-width":"70px"}},[a("el-form-item",{attrs:{label:"角色名称",prop:"name"}},[a("el-input",{model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"角色类型",prop:"selectArr"}},[a("el-select",{staticClass:"filter-item",attrs:{placeholder:"Please select"},model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}},e._l(e.selectArr,function(e,t){return a("el-option",{key:t,attrs:{label:e.value.dic_desc,value:e.field}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"是否启用",prop:"is_enable"}},[a("el-select",{staticClass:"filter-item",attrs:{placeholder:"Please select"},model:{value:e.form.is_enable,callback:function(t){e.$set(e.form,"is_enable",t)},expression:"form.is_enable"}},e._l(e.enableSelect,function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"对照码",prop:"biz_code"}},[a("el-input",{model:{value:e.form.biz_code,callback:function(t){e.$set(e.form,"biz_code",t)},expression:"form.biz_code"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"备注",prop:"remark"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"success",plain:""},on:{click:e.confirmBtn}},[e._v("确认")]),e._v(" "),a("el-button",{attrs:{type:"info",plain:""},on:{click:e.closeDialog}},[e._v("取消")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"新增参数",visible:e.isEditDialogShow},on:{"update:visible":function(t){e.isEditDialogShow=t}}},[a("el-form",{ref:"dataForm",staticStyle:{width:"400px","margin-left":"50px"},attrs:{rules:e.rules,model:e.form,"label-position":"left","label-width":"70px"}},[a("el-form-item",{attrs:{label:"角色名称",prop:"name"}},[a("el-input",{model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"角色类型",prop:"selectArr"}},[a("el-select",{staticClass:"filter-item",attrs:{placeholder:"Please select"},model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}},e._l(e.selectArr,function(e,t){return a("el-option",{key:t,attrs:{label:e.value.dic_desc,value:e.field}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"是否启用",prop:"is_enable"}},[a("el-select",{staticClass:"filter-item",attrs:{placeholder:"Please select"},model:{value:e.form.is_enable,callback:function(t){e.$set(e.form,"is_enable",t)},expression:"form.is_enable"}},e._l(e.enableSelect,function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"对照码",prop:"biz_code"}},[a("el-input",{model:{value:e.form.biz_code,callback:function(t){e.$set(e.form,"biz_code",t)},expression:"form.biz_code"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"备注",prop:"remark"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"success",plain:""},on:{click:e.confirmEditBtn}},[e._v("确认")]),e._v(" "),a("el-button",{attrs:{type:"info",plain:""},on:{click:e.closeDialog}},[e._v("取消")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"新增授权",visible:e.isGrantDialogShow},on:{"update:visible":function(t){e.isGrantDialogShow=t}}},[a("el-row",[a("el-col",{attrs:{span:12}},[a("div",[e._v("经办权限")]),e._v(" "),a("tree",{ref:"grantTree",attrs:{treeData:e.treeData,showCheckbox:!0}})],1),e._v(" "),e.dialogParams.manageTreeDialog?a("el-col",{attrs:{span:12}},[a("div",[e._v("管理权限")]),e._v(" "),a("tree",{ref:"manageTree",attrs:{treeData:e.treeData2,showCheckbox:!0}})],1):e._e()],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"success",plain:""},on:{click:e.grantSaveBtn}},[e._v("保存")]),e._v(" "),a("el-button",{attrs:{type:"info",plain:""},on:{click:function(t){e.isGrantDialogShow=!1}}},[e._v("关闭")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"选择用户",visible:e.isChooseRoleDialogShow},on:{"update:visible":function(t){e.isChooseRoleDialogShow=t}}},[a("el-row",[a("el-col",{attrs:{span:6}},[a("div",[e._v("管理权限")]),e._v(" "),a("tree",{ref:"chooseRoleTree",attrs:{treeData:e.treeData3},on:{nodeClick:e.treeNodeClick}})],1),e._v(" "),a("el-col",{attrs:{span:18}},[a("el-transfer",{attrs:{filterable:"","filter-method":e.transferFilter,"filter-placeholder":"姓名或登录账号",titles:["待选用户列表","已选用户列表"],props:{key:"id",label:"name"},data:e.dialogParams.data},on:{change:e.transferChange},model:{value:e.dialogParams.value,callback:function(t){e.$set(e.dialogParams,"value",t)},expression:"dialogParams.value"}})],1)],1)],1)],1)},staticRenderFns:[]},b=a("VU/8")(v,g,!1,null,null,null);t.default=b.exports}});